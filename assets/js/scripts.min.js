(ReplaceMedia=ReplaceMedia||{}).ModalHtml=function(){var a=this,o=jQuery;return a.activeAttachmentModal=!1,a.activeButton,a.selectors={modalButton:"data-replace-media-modal-button",closeModalButton:".media-modal-close",cancelButton:"data-replace-media-modal-cancel",replacementModal:".media-replacement-modal"},a.bindEvents=function(){o(document).on("click","["+a.selectors.modalButton+"]",function(e){e.preventDefault(),a.replaceModal(o(this))}),o(document).on("click",a.selectors.closeModalButton,function(){a.activeAttachmentModal&&a.revertModal()}),o(document).on("click","["+a.selectors.cancelButton+"]",function(e){e.preventDefault(),a.revertModal()})},a.replaceModal=function(e){a.activeButton=o(e),a.activeAttachmentModal=o(e).parents(".media-modal-content");var t=a.activeAttachmentModal.clone();o(t).find(".attachment-info").remove(),o(t).find(".attachment-media-view").remove(),o(t).find(".edit-media-header").hide(),o(a.activeAttachmentModal).hide(),o(t).insertAfter(a.activeAttachmentModal).addClass("media-replacement-modal"),a.getForm(t)},a.getForm=function(t){var e=o(a.activeButton).attr("data-attachment-id");o.ajax({url:ajaxurl,type:"GET",datatype:"jsonp",data:{action:"replace_media_modal_html",attachment_id:e},success:function(e){o(t).find(".media-frame-content").html(e.html)},error:function(e){console.log(e)}})},a.revertModal=function(){o(a.selectors.replacementModal).remove(),o(".media-modal-content").show(),a.activeAttachmentModal=!1},a.bindEvents()},(ReplaceMedia=ReplaceMedia||{}).ModalForm=function(){var o=this,n=jQuery;return o.selectors={modal:".media-replacement-modal",button:"data-replace-media-form-modal",error:"data-replace-media-form-error",success:"data-replace-media-form-success",link:"data-replace-media-link"},o.bindEvents=function(){n(document).on("click","["+o.selectors.button+"]",function(e){e.preventDefault(),o.submitForm(n(this))})},o.submitForm=function(e){o.toggleLoading(!0),o.toggleError(!1),o.toggleSuccess(!1),o.refreshLink();var t=n(e).parents("form"),a=new FormData(t[0]);n.ajax({url:ajaxurl,type:"POST",data:a,enctype:"multipart/form-data",processData:!1,contentType:!1,cache:!1,timeout:6e5,success:function(e){if(o.toggleLoading(!1),"error"===e.status)return o.toggleError(e.error);o.toggleSuccess(!0)},error:function(e){o.toggleLoading(!1),console.log(e)}})},o.toggleLoading=function(e){var t=n(".replace-media-form");if(e)return n(t).addClass("loading"),void n(t).find("button").attr("disabled",!0);n(t).removeClass("loading"),n(t).find("button").removeAttr("disabled")},o.toggleSuccess=function(e){var t=n("["+o.selectors.success+"]");if(e)return n(".replace-media-form").find('input[name="file"]').val(""),n(""),void n(t).show();n(t).hide()},o.toggleError=function(e){var t=n("["+o.selectors.error+"]");e?n(t).text(e).show():n(t).hide()},o.refreshLink=function(){var e=n("["+o.selectors.link+"]"),t=n(e).attr("href");n(e).attr("href",t+"?v="+(new Date).getTime())},o.bindEvents()};var ReplaceMedia=ReplaceMedia||{};jQuery(document).ready(function(){new ReplaceMedia.Factory}),ReplaceMedia.Factory=function(){jQuery;return this.build=function(){new ReplaceMedia.ModalHtml,new ReplaceMedia.ModalForm},this.build()};